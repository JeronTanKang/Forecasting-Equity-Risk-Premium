Load packages: 
```{r}
library(xgboost)
library(dplyr)
```

Function for xgboost h step ahead forecast. 
To be used in the model code chunk in forecast_evaluation.rmd. 

NOTE: hardcoded hyperparameter values are taken from the individual tuning scripts

```{r}
model <- function(df, h) {
  df_std = df %>% mutate(across(-c(date, erp), ~ as.numeric(scale(.)))) %>% arrange(date)
  df_std = df_std %>% mutate(target = dplyr::lead(erp, n = h)) %>% select(date, target, everything())

  df_forecast = df_std %>% dplyr::slice(n()-h+1)
  df_train = df_std %>% dplyr::slice(1:(n() - h))

  feats <- setdiff(names(df_std), c("date", "target"))

  x_train <- as.matrix(df_train[, feats, drop = FALSE])
  y_train <- df_train$target
  x_forecast <- as.matrix(df_forecast[, feats, drop=FALSE])
  
  dtrain <- xgb.DMatrix(data = x_train, label = y_train)
  dforecast <- xgb.DMatrix(data = x_forecast)

  set.seed(456857)

  # nrounds, eta, max_depth is tuned
  xgb_fit <- xgboost(
    data = dtrain,
    objective = "reg:squarederror",
    eval_metric = "rmse",
    nrounds = 500,
    eta = 0.01,
    max_depth = 2,
    min_child_weight = 1,
    subsample = 0.5,
    colsample_bytree = 0.5,
    gamma = 0,
    verbose = 0
  )

  pred <- predict(xgb_fit, newdata = dforecast)
  return(pred)
}
```
